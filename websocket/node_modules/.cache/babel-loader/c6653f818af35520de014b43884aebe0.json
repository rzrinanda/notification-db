{"remainingRequest":"/home/usr/training/day8/exercise/websocket/node_modules/babel-loader/lib/index.js!/home/usr/training/day8/exercise/websocket/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/usr/training/day8/exercise/websocket/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/usr/training/day8/exercise/websocket/src/App.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/usr/training/day8/exercise/websocket/src/App.vue","mtime":1576657787017},{"path":"/home/usr/training/day8/exercise/websocket/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/usr/training/day8/exercise/websocket/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/usr/training/day8/exercise/websocket/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/usr/training/day8/exercise/websocket/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZGF0ZS50by1pc28tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZGF0ZS50by1zdHJpbmciOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgeyBOb3R5ZiB9IGZyb20gIm5vdHlmIjsKaW1wb3J0ICJub3R5Zi9ub3R5Zi5taW4uY3NzIjsKaW1wb3J0IENoYXRGb3JtIGZyb20gIi4vY29tcG9uZW50cy9DaGF0Rm9ybSI7CmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnQ6IHsKICAgIENoYXRGb3JtOiBDaGF0Rm9ybQogIH0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIG5vdGlmaWVyOiBuZXcgTm90eWYoKSwKICAgICAgbWU6ICJwZXJzb24xIiwKICAgICAgdG86ICJwZXJzb24yIiwKICAgICAgbWVzc2FnZTogIkhlbGxvIiwKICAgICAgaW5jb21pbmdNZXNzYWdlczogW10sCiAgICAgIGluY29taW5nUHJpdmF0ZU1lc3NhZ2VzOiBbXSwKICAgICAgY29ubmVjdGlvbjogbnVsbAogICAgfTsKICB9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICB0aGlzLnJlZ2lzdGVyV1MoKTsKICB9LAogIG1ldGhvZHM6IHsKICAgIHNlbmRNZXNzYWdlOiBmdW5jdGlvbiBzZW5kTWVzc2FnZSgpIHsKICAgICAgdmFyIGRhdGEgPSBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgInByaXZhdGUiOiBmYWxzZSwKICAgICAgICBmcm9tOiB0aGlzLm1lLAogICAgICAgIHRvOiB0aGlzLnRvLAogICAgICAgIG1lc3NhZ2U6IHRoaXMubWVzc2FnZQogICAgICB9KTsKICAgICAgdmFyIGZvcm0gPSB7CiAgICAgICAgbmFtZTogdGhpcy5tZSwKICAgICAgICB0bzogdGhpcy50bywKICAgICAgICBtZXNzYWdlOiB0aGlzLm1lc3NhZ2UsCiAgICAgICAgZGF0ZTogbmV3IERhdGUoKQogICAgICB9OwogICAgICB0aGlzLmNvbm5lY3Rpb24uc2VuZChkYXRhKTsKICAgICAgdmFyIHJlc3BvbnNlID0gYXhpb3MucG9zdCgiY2hhdHMvaW5zZXJ0IiwgZm9ybSk7CiAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTsKICAgIH0sCiAgICBwcml2YXRlTWVzc2FnZTogZnVuY3Rpb24gcHJpdmF0ZU1lc3NhZ2UoKSB7CiAgICAgIHZhciBkYXRhID0gSlNPTi5zdHJpbmdpZnkoewogICAgICAgICJwcml2YXRlIjogdHJ1ZSwKICAgICAgICBmcm9tOiB0aGlzLm1lLAogICAgICAgIHRvOiB0aGlzLnRvLAogICAgICAgIG1lc3NhZ2U6IHRoaXMubWVzc2FnZQogICAgICB9KTsKICAgICAgdmFyIHBheWxvYWQgPSB7CiAgICAgICAgbmFtZTogdGhpcy5tZSwKICAgICAgICBkYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgbWVzc2FnZTogdGhpcy5tZXNzYWdlCiAgICAgIH07CiAgICAgIHRoaXMuaW5jb21pbmdQcml2YXRlTWVzc2FnZXMucHVzaChwYXlsb2FkKTsKICAgICAgdGhpcy5jb25uZWN0aW9uLnNlbmQoZGF0YSk7CiAgICAgIHZhciByZXNwb25zZSA9IGF4aW9zLnBvc3QoImNoYXRzL2luc2VydCIsIGZvcm0pOwogICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7CiAgICB9LAogICAgcmVnaXN0ZXJXUzogZnVuY3Rpb24gcmVnaXN0ZXJXUygpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHZhciB1cmwgPSAid3M6Ly9sb2NhbGhvc3Q6ODAwMSI7CiAgICAgIHRoaXMuY29ubmVjdGlvbiA9IG5ldyBXZWJTb2NrZXQodXJsKTsKCiAgICAgIHRoaXMuY29ubmVjdGlvbi5vbm9wZW4gPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICBjb25zb2xlLmxvZygiV2UgYXJlIGNvbm5lY3RlZCIsIGV2ZW50KTsKICAgICAgfTsKCiAgICAgIHRoaXMuY29ubmVjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5sb2coIldlYlNvY2tldCBlcnJvcjogIi5jb25jYXQoZXJyb3IpKTsKICAgICAgfTsKCiAgICAgIHRoaXMuY29ubmVjdGlvbi5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UoZXZlbnQuZGF0YSk7CiAgICAgICAgY29uc29sZS5sb2coZGF0YSk7CgogICAgICAgIGlmIChkYXRhWyJwcml2YXRlIl0gJiYgZGF0YS50byA9PT0gX3RoaXMubWUpIHsKICAgICAgICAgIHZhciBwYXlsb2FkID0gewogICAgICAgICAgICBuYW1lOiBkYXRhLmZyb20sCiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgbWVzc2FnZTogZGF0YS5tZXNzYWdlCiAgICAgICAgICB9OwoKICAgICAgICAgIF90aGlzLmluY29taW5nUHJpdmF0ZU1lc3NhZ2VzLnB1c2gocGF5bG9hZCk7CgogICAgICAgICAgX3RoaXMubm90aWZpZXIuc3VjY2VzcyhkYXRhLm1lc3NhZ2UpOwogICAgICAgIH0gZWxzZSBpZiAoIWRhdGFbInByaXZhdGUiXSkgewogICAgICAgICAgdmFyIF9wYXlsb2FkID0gewogICAgICAgICAgICBuYW1lOiBkYXRhLmZyb20sCiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgbWVzc2FnZTogZGF0YS5tZXNzYWdlCiAgICAgICAgICB9OwoKICAgICAgICAgIF90aGlzLmluY29taW5nTWVzc2FnZXMucHVzaChfcGF5bG9hZCk7CgogICAgICAgICAgX3RoaXMubm90aWZpZXIuc3VjY2VzcyhkYXRhLm1lc3NhZ2UpOwogICAgICAgIH0KICAgICAgfTsKICAgIH0KICB9Cn07"},{"version":3,"sources":["App.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"container\">\n    <div class=\"flex justify-between\">\n      <div>\n        <h1>Send Notification</h1>\n\n        <!-- <chat-form /> -->\n        <form method=\"POST\" @submit.prevent=\"sendMessage\">\n          <p>\n            Me\n            <input type=\"text\" v-model=\"me\" required />\n          </p>\n          <p>\n            To\n            <input type=\"text\" v-model=\"to\" required />\n            <button type=\"button\" @click=\"privateMessage\">Private Message</button>\n          </p>\n          <p>\n            Message\n            <input type=\"text\" v-model=\"message\" required />\n          </p>\n\n          <button type=\"submit\">Public Message</button>\n        </form>\n        <ul>\n          <li v-for=\"(msg, i) in incomingMessages\" :key=\"i\">\n            <!-- [{{ msg.date }}]   -->\n            {{ msg.name }} :\n            {{ msg.message }}\n          </li>\n        </ul>\n        <ul>\n          <li v-for=\"(msg, i) in incomingPrivateMessages\" :key=\"i\">\n            <!-- [{{ msg.date }}]   -->\n            {{ msg.name }} :\n            {{ msg.message }}\n          </li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { Notyf } from \"notyf\";\nimport \"notyf/notyf.min.css\";\nimport ChatForm from \"./components/ChatForm\";\nimport axios from \"axios\";\n\nexport default {\n  component: {\n    ChatForm\n  },\n  data: () => ({\n    notifier: new Notyf(),\n    me: \"person1\",\n    to: \"person2\",\n    message: \"Hello\",\n    incomingMessages: [],\n    incomingPrivateMessages: [],\n    connection: null\n  }),\n\n  mounted() {\n    this.registerWS();\n  },\n\n  methods: {\n    sendMessage() {\n      const data = JSON.stringify({\n        private: false,\n        from: this.me,\n        to: this.to,\n        message: this.message\n      });\n      const form = {\n        name: this.me,\n        to: this.to,\n        message: this.message,\n        date: new Date()\n      }\n\n      this.connection.send(data);\n      const response = axios.post(\"chats/insert\", form);\n      console.log(response)\n    },\n\n    privateMessage() {\n      const data = JSON.stringify({\n        private: true,\n        from: this.me,\n        to: this.to,\n        message: this.message\n      });\n\n      const payload = {\n        name: this.me,\n        date: new Date().toISOString(),\n        message: this.message\n      };\n\n      this.incomingPrivateMessages.push(payload);\n\n      this.connection.send(data);\n      const response = axios.post(\"chats/insert\", form);\n      console.log(response)\n    },\n\n    registerWS() {\n      const url = \"ws://localhost:8001\";\n      this.connection = new WebSocket(url);\n\n      this.connection.onopen = event => {\n        console.log(\"We are connected\", event);\n      };\n\n      this.connection.onerror = error => {\n        console.log(`WebSocket error: ${error}`);\n      };\n\n      this.connection.onmessage = event => {\n        const data = JSON.parse(event.data);\n\n        console.log(data);\n\n        if (data.private && data.to === this.me) {\n          const payload = {\n            name: data.from,\n            date: new Date().toISOString(),\n            message: data.message\n          };\n\n          this.incomingPrivateMessages.push(payload);\n\n          this.notifier.success(data.message);\n        } else if (!data.private) {\n          const payload = {\n            name: data.from,\n            date: new Date().toISOString(),\n            message: data.message\n          };\n\n          this.incomingMessages.push(payload);\n\n          this.notifier.success(data.message);\n        }\n      };\n    }\n  }\n};\n</script>\n\n<style scoped>\n.container {\n  margin: auto;\n  width: 800px;\n}\n.flex {\n  display: flex;\n}\n.justify-between {\n  justify-content: space-between;\n}\n</style>\n"],"sourceRoot":"src"}]}